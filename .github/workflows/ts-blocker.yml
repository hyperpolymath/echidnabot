# SPDX-License-Identifier: AGPL-3.0-or-later
name: TypeScript/JavaScript Blocker
on: [push, pull_request]

permissions: read-all

jobs:
  check:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: Block new TypeScript/JavaScript
        run: |
          TS_FILES=$(find . -type f \( -name "*.ts" -o -name "*.tsx" \) 2>/dev/null | grep -v '\.gen\.' || true)
          JS_FILES=$(find . -type f \( -name "*.js" -o -name "*.jsx" -o -name "*.mjs" -o -name "*.cjs" \) 2>/dev/null | grep -v '\.res\.js$' | grep -v '\.gen\.' | grep -v 'node_modules' || true)
          TS_CONFIGS=$(find . -type f \( -name "tsconfig*.json" -o -name "package.json" \) 2>/dev/null | grep -v 'node_modules' || true)

          if [ -n "$TS_FILES" ] || [ -n "$JS_FILES" ] || [ -n "$TS_CONFIGS" ]; then
            echo "❌ TypeScript/JavaScript usage detected. Use ReScript instead."
            [ -n "$TS_FILES" ] && echo "$TS_FILES"
            [ -n "$JS_FILES" ] && echo "$JS_FILES"
            [ -n "$TS_CONFIGS" ] && echo "$TS_CONFIGS"
            exit 1
          fi
          echo "✅ ReScript-only policy enforced"
